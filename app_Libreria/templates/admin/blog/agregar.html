{% extends 'base.html' %}

{% block content %}
<div class="container mt-4">
    <h1 class="text-verde mb-4">Agregar Nueva Entrada al Blog</h1>
    
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-danger">{{ message }}</div>
    {% endfor %}
    {% endif %}
    
    <div class="card">
        <div class="card-body">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="mb-3">
                            <label class="form-label">Título *</label>
                            <input type="text" class="form-control" name="titulo" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label class="form-label">Categoría *</label>
                            <select class="form-control" name="categoria" required>
                                <option value="GENERAL">General</option>
                                <option value="RESENA">Reseñas de Libros</option>
                                <option value="AUTOR">Autores y Escritores</option>
                                <option value="EVENTO">Eventos Literarios</option>
                                <option value="TALLER">Talleres y Cursos</option>
                                <option value="NOTICIA">Noticias Editoriales</option>
                                <option value="RECOMENDACION">Recomendaciones</option>
                                <option value="ENTREVISTA">Entrevistas</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Resumen *</label>
                    <textarea class="form-control" name="resumen" rows="3" required placeholder="Resumen breve que aparecerá en la lista de artículos..."></textarea>
                    <small class="text-muted">Máximo 200 caracteres. Este resumen aparecerá en la vista previa.</small>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Contenido *</label>
                    <textarea class="form-control" name="contenido" rows="10" required placeholder="Escribe aquí el contenido completo del artículo..."></textarea>
                    <small class="text-muted">Usa párrafos claros, subtítulos y listas para mejor legibilidad.</small>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Imagen Destacada</label>
                    <input type="file" class="form-control" name="imagen" accept="image/*">
                    <small class="text-muted">Tamaño recomendado: 1200x630px para redes sociales. Formatos: JPG, PNG</small>
                </div>
                
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" name="activo" id="activo" checked>
                    <label class="form-check-label" for="activo">
                        Publicar inmediatamente (visible al público)
                    </label>
                </div>
                
                <div class="alert alert-info">
                    <h6><i class="fas fa-lightbulb"></i> Consejos para un buen artículo:</h6>
                    <ul class="mb-0">
                        <li>Usa un título atractivo y descriptivo</li>
                        <li>Estructura el contenido con subtítulos</li>
                        <li>Incluye imágenes relevantes</li>
                        <li>Revisa ortografía y gramática</li>
                        <li>Termina con una conclusión o llamado a la acción</li>
                    </ul>
                </div>
                
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-verde">Publicar Entrada</button>
                    <a href="{% url 'admin_blog' %}" class="btn btn-secondary">Cancelar</a>
                    <button type="button" class="btn btn-outline-info" onclick="guardarBorrador()">
                        Guardar como Borrador
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function guardarBorrador() {
    // Desmarcar la casilla de activo
    document.getElementById('activo').checked = false;
    // Enviar el formulario
    document.querySelector('form').submit();
}

// Contador de caracteres para resumen
document.addEventListener('DOMContentLoaded', function() {
    const resumenTextarea = document.querySelector('textarea[name="resumen"]');
    const contadorDiv = document.createElement('div');
    contadorDiv.className = 'text-muted text-end mt-1';
    contadorDiv.innerHTML = '<small>Caracteres: <span id="contadorCaracteres">0</span>/200</small>';
    resumenTextarea.parentNode.appendChild(contadorDiv);
    
    resumenTextarea.addEventListener('input', function() {
        const contador = document.getElementById('contadorCaracteres');
        const longitud = this.value.length;
        contador.textContent = longitud;
        
        if (longitud > 200) {
            contador.style.color = 'red';
            contador.textContent += ' (¡Demasiado largo!)';
        } else if (longitud > 180) {
            contador.style.color = 'orange';
        } else {
            contador.style.color = 'green';
        }
    });
    
    // Disparar evento para calcular longitud inicial
    resumenTextarea.dispatchEvent(new Event('input'));
});
</script>

<style>
.form-control:focus {
    border-color: var(--verde-principal);
    box-shadow: 0 0 0 0.2rem rgba(46, 139, 87, 0.25);
}
textarea {
    resize: vertical;
}
</style>
{% endblock %}